<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Absensi QR</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    .time { font-size: 18px; margin-bottom: 15px; }
    .qr-box { display: inline-block; margin: 20px; padding: 20px; border: 2px solid #333; border-radius: 12px; }
    .disabled { opacity: 0.2; filter: blur(6px); }
    button { margin: 5px; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; }
    .enable { background: #4CAF50; color: #fff; }
    .disable { background: #f44336; color: #fff; }
  </style>
</head>
<body>
  <h2>ðŸ“Œ Absensi QR</h2>
  <div class="time" id="clock"></div>

  <div class="qr-box">
    <h3>Masuk</h3>
    <div id="qrcodeMasuk"></div>
    <p id="tokenMasuk"></p>
    <button class="enable" onclick="enableQR('masuk')">Enable</button>
    <button class="disable" onclick="disableQR('masuk')">Disable</button>
  </div>

  <div class="qr-box">
    <h3>Pulang</h3>
    <div id="qrcodePulang"></div>
    <p id="tokenPulang"></p>
    <button class="enable" onclick="enableQR('pulang')">Enable</button>
    <button class="disable" onclick="disableQR('pulang')">Disable</button>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzhW_w2aKEmHKaUvkdDkUl3W_8VU6RrGUZHqQB1B5Z8LHyPpdHJda1xNv_dxBonJ_QsJQ/exec";

    let qrcodeMasuk = new QRCode(document.getElementById("qrcodeMasuk"), { width: 180, height: 180 });
    let qrcodePulang = new QRCode(document.getElementById("qrcodePulang"), { width: 180, height: 180 });

    function updateTime() {
      const now = new Date();
      document.getElementById("clock").textContent = now.toLocaleString("id-ID", { dateStyle: "full", timeStyle: "medium" });
    }
    setInterval(updateTime, 1000);
    updateTime();

    function generateToken() {
      return Math.floor(Date.now() / 10000); // token baru tiap 10 detik
    }

    function updateQR() {
      const token = generateToken();
      qrcodeMasuk.clear();
      qrcodeMasuk.makeCode(`${GAS_URL}?type=Masuk&t=${token}`);
      document.getElementById("tokenMasuk").textContent = "Token: " + token;

      qrcodePulang.clear();
      qrcodePulang.makeCode(`${GAS_URL}?type=Pulang&t=${token}`);
      document.getElementById("tokenPulang").textContent = "Token: " + token;
    }
    setInterval(updateQR, 10000);
    updateQR();

    function enableQR(mode) {
      if (mode === "masuk") {
        document.getElementById("qrcodeMasuk").classList.remove("disabled");
        document.getElementById("qrcodePulang").classList.add("disabled");
      } else {
        document.getElementById("qrcodePulang").classList.remove("disabled");
        document.getElementById("qrcodeMasuk").classList.add("disabled");
      }
    }

    function disableQR(mode) {
      if (mode === "masuk") {
        document.getElementById("qrcodeMasuk").classList.add("disabled");
      } else {
        document.getElementById("qrcodePulang").classList.add("disabled");
      }
    }
  </script>
</body>
</html>
